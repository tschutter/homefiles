#!/usr/bin/env python

"""
Read Unicode text and encode it as plain ASCII.
"""

import optparse
import sys
import unicodedata

# http://www.utf8-chartable.de/unicode-utf8-table.pl?start=8192&number=128
XTABLE = {
    0x2010: 0x2D,  # HYPHEN
    0x2011: 0x2D,  # NON-BREAKING HYPHEN
    0x2012: 0x2D,  # FIGURE DASH
    0x2013: 0x2D,  # EN DASH
    0x2014: 0x2D,  # EM DASH
    0x2015: 0x2D,  # HORIZONTAL BAR
    0x2018: 0x27,  # LEFT SINGLE QUOTATION MARK
    0x2019: 0x27,  # RIGHT SINGLE QUOTATION MARK
    0x201C: 0x22,  # LEFT DOUBLE QUOTATION MARK
    0x201D: 0x22,  # RIGHT DOUBLE QUOTATION MARK
    0x2024: u".",  # ONE DOT LEADER
    0x2025: u"..",  # TWO DOT LEADER
    0x2026: u"...",  # HORIZONTAL ELLIPSIS
}

def main():
    """main"""
    # Process command line.
    option_parser = optparse.OptionParser(
        usage="usage: %prog [FILE]...\n" +
            "  Converts Unicode to ASCII for each FILE.  With no FILE,\n" +
            "  or when FILE is -, reads standard input.",
    )
    (_, args) = option_parser.parse_args()
    if len(args) == 0:
        args.append("-")

    for arg in args:
        if arg == "-":
            text = sys.stdin.read()
        else:
            text = open(arg, "rb").read()
        utext = text.decode("utf8")
        utext = unicodedata.normalize("NFKD", utext)
        utext = utext.translate(XTABLE)
        try:
            utext.encode("ascii", "strict")
        except UnicodeEncodeError as err:
            if arg == "-":
                errfile = ""
            else:
                errfile = "In '%s', " % arg
            sys.stderr.write(
                "ERROR: %s%s\n" % (errfile, str(err))
            )
        text = utext.encode("ascii", "backslashreplace")
        sys.stdout.write(text)


if __name__ == "__main__":
    sys.exit(main())
